<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Lab 1 : Setup - Lab Manuals</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Lab 1 : Setup";
        var mkdocs_page_input_path = "seh500/lab1.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Lab Manuals
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../aig240/">AIG240 Robotics</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../ses250/">SES250 Electromagnatics</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../">SEH500 Microprocessors</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../sep600/">SEP600 Embedded Systems</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../sea700/">SEA700 Robotics for Engineer</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Lab Manuals</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Lab 1 : Setup</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="lab-1-setup">Lab 1 : Setup</h1>
<p><font size="5">
Seneca Polytechnic</br>
SEH500 Microprocessors and Computer Architecture
</font></p>
<h2 id="introduction">Introduction</h2>
<p>The Freedom-K64F and Freedom-K66F are both low-cost development platforms using the NXP Kinetis series of microcontrollers based on the ARM Cortex-M4 processor.</p>
<table>
<thead>
<tr>
<th>Features</th>
<th><a href="https://www.nxp.com/design/development-boards/freedom-development-boards/mcu-boards/freedom-development-platform-for-kinetis-k64-k63-and-k24-mcus:FRDM-K64F">K64F</a></th>
<th><a href="https://www.nxp.com/design/development-boards/freedom-development-boards/mcu-boards/freedom-development-platform-for-kinetis-k66-k65-and-k26-mcus:FRDM-K66F">K66F</a></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Microcontroller</strong></td>
<td>MK64FN1M0VLL12</td>
<td>MK66FN2M0VMD18</td>
</tr>
<tr>
<td><strong>Speed</strong></td>
<td>120 MHz</td>
<td>180 MHz</td>
</tr>
<tr>
<td><strong>RAM</strong></td>
<td>256 kB</td>
<td>256 kB</td>
</tr>
<tr>
<td><strong>External Memory</strong></td>
<td>N/A</td>
<td>microSD socket</td>
</tr>
<tr>
<td><strong>Connectivity</strong></td>
<td>USB, Ethernet, Add-on Bluetooth</td>
<td>USB, Ethernet, Add-on Bluetooth</td>
</tr>
<tr>
<td><strong>Audio</strong></td>
<td>N/A</td>
<td>Audio codec and Jacks</td>
</tr>
<tr>
<td><strong>Sensors</strong></td>
<td>Accelerometer and Magnetometer<br/>(FXOS8700CQ)<br/><strong>No longer populated!</strong></td>
<td>Accelerometer and Magnetometer<br/>(FXOS8700CQ)<br/>Gyroscope (FXAS21002)</td>
</tr>
<tr>
<td><strong>Debug</strong></td>
<td>OpenSDAv2<br/>Virtual Serial Port</td>
<td>OpenSDAv2<br/>Virtual Serial Port</td>
</tr>
<tr>
<td><strong>User Components</strong></td>
<td>RGB LED</td>
<td>RGB LED<br/>Two user push buttons</td>
</tr>
</tbody>
</table>
<h2 id="preparation">Preparation</h2>
<p>Read over the lab manual for this lab. Acquire the Freedom microcontroller board and install the necessary IDE as described in the lab manual.</p>
<p>Documentation of the Cortex-M4 instruction set, board user's guide, and the microcontroller reference manual can be found here:</p>
<ul>
<li><a href="https://developer.arm.com/documentation/100166/0001">Arm Cortex-M4 Processor Technical Reference Manual Revision</a> (<a href="../Cortex-M4-Proc-Tech-Ref-Manual.pdf">PDF</a>)</li>
<li><a href="https://developer.arm.com/documentation/ddi0403/latest/">ARMv7-M Architecture Reference Manual</a> (<a href="../DDI0403E_e_armv7m_arm.pdf">PDF</a>)</li>
<li><a href="https://www.nxp.com/webapp/Download?colCode=FRDMK64FUG">FRDM-K64F Freedom Module User’s Guide</a> (<a href="../FRDMK64FUG.pdf">PDF</a>)</li>
<li><a href="https://www.nxp.com/webapp/Download?colCode=K64P144M120SF5RM">Kinetis K64 Reference Manual</a> (<a href="../K64P144M120SF5RM.pdf">PDF</a>)</li>
<li><a href="https://www.nxp.com/webapp/Download?colCode=FRDMK66FUG">FRDM-K66F Freedom Module User’s Guide</a> (<a href="../FRDMK66FUG.pdf">PDF</a>)</li>
<li><a href="https://www.nxp.com/webapp/Download?colCode=K66P144M180SF5RMV2">Kinetis K66 Reference Manual</a> (<a href="../K66P144M180SF5RMV2.pdf">PDF</a>)</li>
<li><a href="https://senecacollege.primo.exlibrisgroup.com/permalink/01SENC_INST/goqo0g/alma997565899003226">The Definitive Guide to ARM® Cortex®-M3 and Cortex®-M4 Processors</a> by Joseph Yiu</li>
</ul>
<h2 id="procedures">Procedures</h2>
<h3 id="firmware-update">Firmware Update</h3>
<p>If you are using the Freedom-K64F, you might need to update its firmware before using it with Windows 10. Even if you are not using Windows 10, updating the firmware might be a good idea.</p>
<ol>
<li>
<p>If you are using Windows OS, follow step 1-4 to disable the storage service on the <a href="https://www.nxp.com/document/guide/getting-started-with-the-frdm-k64f:NGS-FRDM-K64F?section=plug-it-in_plug-it-in-1">Getting Started with the FRDM-K64F</a> BUT DO NOT FOLLOW ANY OTHER STEPS.</p>
</li>
<li>
<p>Unplug the Freedom board then hold down the "RESET SW1" button as you plug the board into your computer to enter bootloader mode.
    
    <img alt="Figure 1.1 Start in Bootloader Mode" src="../lab1-bootloader.png" />
            
    <em><strong>Figure 1.1</strong> Start in Bootloader Mode</em></p>
</li>
<li>
<p>Once plugged in, if you see "BOOTLOADER", then we need to update the firmware. If you see "MAINTENANCE", then you most likely have the latest firmware and don't need to perform an update.</p>
</li>
<li>
<p>Once in bootloader mode, copy the bootloader files below into the "BOOTLOADER" drive. The board should load the .bin file then restart into "MAINTENANCE". If the board does not restart, manually restart it by unplugging power. If "BOOTLOADER" directory is still showing, repeat the process.</p>
<ul>
<li>K64F Bootloader: <a href="../0244_k20dx_bootloader_update_0x5000.bin">0244_k20dx_bootloader_update_0x5000.bin</a> for updating the OpenSDA bootloader</li>
<li>K66F Bootloader: <a href="../0244_k20dx_bootloader_update_0x8000.bin">0244_k20dx_bootloader_update_0x8000.bin</a> for updating the OpenSDA bootloader</li>
</ul>
<p>(Reference: <a href="https://os.mbed.com/blog/entry/DAPLink-bootloader-update/">DAPLink bootloader update</a>)</p>
<p>If the bootloader drive is not showing, try updating the bootloader using a non-Windows 10 computer. If it is still not showing up, the board might be in a bricked state. In this case, an external device must be used to flash a new bootloader. <a href="https://os.mbed.com/blog/entry/DAPLink-bootloader-updates-with-external/">Follow the instructions here</a>.</p>
</li>
<li>
<p>Once you see the "MAINTENANCE" drive. Load the firmware application back onto the board using the same methods as above.</p>
<ul>
<li>K64F Firmware Application: <a href="../k20dx_frdmk64f_if_crc_legacy_0x5000.bin">k20dx_frdmk64f_if_crc_legacy_0x5000</a> for loading the CMSIS-DAP application back onto the board</li>
<li>K66F Firmware Application: <a href="../k20dx_frdmk66f_if_crc.bin">k20dx_frdmk66f_if_crc</a> for loading the CMSIS-DAP application back onto the board</li>
</ul>
<p>(Reference: <a href="https://www.nxp.com/opensda">OpenSDA Serial and Debug Adapter</a>)</p>
<p>*** Later in the Lab, if you get an "0 SWD device available" error, this is usually due to a conflict with the firmware. To resoluve this, load the <a href="https://www.segger.com/downloads/jlink/#JLinkOpenSDABoardSpecificFirmwares">Segger Jlink OpenSDA Firmware</a> on your board then run debug using Segger JLink as the debugger. Once a program can be uploaded onto your board, you may switch back to the DAPLink firmware. </p>
</li>
</ol>
<h3 id="install-ide">Install IDE</h3>
<ol>
<li>
<p>Install the <a href="https://www.nxp.com/design/software/mcuxpresso-software-and-tools-/mcuxpresso-integrated-development-environment-ide:MCUXpresso-IDE?#design-resources">MCUXpresso IDE from NXP</a> (account creation required) or using <a href="https://myapps.senecacollege.ca/">Seneca MyApps</a>. <strong>NOTE:</strong> If the board is not recognized by Windows, <a href="https://os.mbed.com/media/downloads/drivers/mbedWinSerial_16466.exe">download the latest driver</a> for Windows. Links to other drivers such as P&amp;E Micro and Segger Jlink can be found here: <a href="https://www.nxp.com/design/software/sensor-toolbox/opensda-serial-and-debug-adapter:OPENSDA?tid=vanOpenSDA#FRDM-K64F">OpenSDA Serial and Debug Adapter</a>.</p>
<p><img alt="Figure 1.2 Seneca MyApps" src="../lab1-myapps.png" /></p>
<p><em><strong>Figure 1.2</strong> Seneca MyApps</em></p>
</li>
<li>
<p>Select an appropriate location to save your workspace. It must be a directory to which you have "write" permission.</p>
<p><img alt="Figure 1.3 Select Workspace Directory" src="../lab1-workspace.png" /></p>
<p><em><strong>Figure 1.3</strong> Select Workspace Directory</em></p>
</li>
</ol>
<h3 id="install-sdk">Install SDK</h3>
<ol>
<li>
<p>Once MCUXpresso opens, click "Download and Install SDK" from the quick-start menu.</p>
<p><img alt="Figure 1.4 Download and Install SDK" src="../lab1-download-install-sdk.png" /></p>
<p><em><strong>Figure 1.4</strong> Download and Install SDK</em></p>
</li>
<li>
<p>Filter for "K64" or "K66" depending on the version of the board you are using then install the SDK.</p>
<p><img alt="Figure 1.5 Filter SDK" src="../lab1-filter-sdk.png" /></p>
<p><em><strong>Figure 1.5</strong> Filter SDK</em></p>
<p><img alt="Figure 1.6 Select SDK" src="../lab1-select-sdk.png" /></p>
<p><em><strong>Figure 1.6</strong> Select SDK</em></p>
<p><img alt="Figure 1.7 Install SDK" src="../lab1-install-sdk.png" /></p>
<p><em><strong>Figure 1.7</strong> Install SDK</em></p>
</li>
</ol>
<h3 id="import-sdk-example">Import SDK Example</h3>
<ol>
<li>
<p>After downloading and installing the SDK, close the welcome screen. At the bottom left Quickstart Panel, click "Import SDK example(s)...".</p>
<p><img alt="Figure 1.8 Import SDK Example" src="../lab1-import-example.png" /></p>
<p><em><strong>Figure 1.8</strong> Install SDK</em></p>
</li>
<li>
<p>Select the appropriate example library.</p>
<p><img alt="Figure 1.9 Select Example Library" src="../lab1-select-example.png" /></p>
<p><em><strong>Figure 1.9</strong> Select Example Library</em></p>
</li>
<li>
<p>Find the "hello_world" example from "demo_apps".</p>
<p><img alt="Figure 1.10 Select Hello World Demo" src="../lab1-hello-world.png" /></p>
<p><em><strong>Figure 1.10</strong> Select Hello World Demo</em></p>
</li>
<li>
<p>Ensure "SDK Debug Console" under Project Options is selected as UART then click "Next".</p>
<p><img alt="Figure 1.11 SDK Debug Console UART" src="../lab1-uart.png" /></p>
<p><em><strong>Figure 1.11</strong> SDK Debug Console UART</em></p>
</li>
<li>
<p>In the project Advanced Settings page, ensure to CLEAR the "Redirect SDK PRINTF to C library printf" option then click "Finish".</p>
<p><img alt="Figure 1.12 Clear Redirect SDK PRINTF to C library printf" src="../lab1-printf.png" /></p>
<p><em><strong>Figure 1.12</strong> Clear Redirect SDK PRINTF to C library printf</em></p>
</li>
</ol>
<h3 id="code-build-and-debug-project">Code, Build and Debug Project</h3>
<ol>
<li>
<p>By now, you should be able to see a familiar interface with a project tree on the left and a code in the middle. Take a look at the code and get an idea of what it is performing. Afterward, click "Build" at the lower left Quickstart Panel to compile the code.</p>
<p><img alt="Figure 1.13 Demo Project Code" src="../lab1-project-code.png" /></p>
<p><em><strong>Figure 1.13</strong> Demo Project Code</em></p>
<p><img alt="Figure 1.14 Build Project" src="../lab1-build.png" /></p>
<p><em><strong>Figure 1.14</strong> Build Project</em></p>
</li>
<li>
<p>Once the project is built, click "Debug" to run the project in debug mode.</p>
<p><img alt="Figure 1.15 Run in Debug Mode" src="../lab1-debug.png" /></p>
<p><em><strong>Figure 1.15</strong> Run in Debug Mode</em></p>
</li>
<li>
<p>The IDE should automatically probe for and connect to the target microcontroller board. Click "OK".</p>
<p><img alt="Figure 1.16 Connect to target" src="../lab1-probe.png" /></p>
<p><em><strong>Figure 1.16</strong> Connect to target</em></p>
</li>
</ol>
<h3 id="serial-terminal">Serial Terminal</h3>
<ol>
<li>
<p>Open a Serial terminal in the IDE by clicking on the "Terminal" tab beside the "Console" tab at the bottom of the screen. Select the appropriate COM port that the microcontroller board is connected to (check the device manager of your computer). Ensure the settings are 115200 baud rate with 8-bit data size, no parity bit, and 1 stop bit.</p>
<p><img alt="Figure 1.17 Start a Serial Terminal" src="../lab1-serial-terminal.png" /></p>
<p><em><strong>Figure 1.17</strong> Start a Serial Terminal</em></p>
</li>
<li>
<p>Once the terminal is connected, press "Resume" from the debug menu and you should see "Hello World" in the serial terminal.</p>
<p><img alt="Figure 1.18 Press Resume" src="../lab1-resume.png" /></p>
<p><em><strong>Figure 1.18</strong> Press Resume</em></p>
<p><img alt="Figure 1.19 Hello World in Serial Terminal" src="../lab1-hello-world-output.png" /></p>
<p><em><strong>Figure 1.19</strong> Hello World in Serial Terminal</em></p>
</li>
</ol>
<h3 id="view-assembly-code">View Assembly Code</h3>
<ol>
<li>
<p>Lastly, let's take a look at the assembly language code. From the project tree on the left, find the "Debug" directory. Within the directory, right-click on the .axf file then click Binary Utilities &gt; Disassemble.</p>
<p><img alt="Figure 1.20 View Disassembled Code" src="../lab1-tree-debug.png" /></p>
<p><em><strong>Figure 1.20</strong> View Disassembled Code</em></p>
</li>
<li>
<p>A new .dis file should be created. Open the file to see the disassembled code.</p>
<p><img alt="Figure 1.21 Disassembled Code" src="../lab1-disassembled-code.png" /></p>
<p><em><strong>Figure 1.21</strong> Disassembled Code</em></p>
</li>
<li>
<p>Another way to see the assembly code is to view it live during execution. To do that, at the top menu, go to "Windows &gt; Show View &gt; Other" and then type in Disassembly.</p>
</li>
</ol>
<h3 id="view-the-registers-value-and-memory-data-during-debug">View the Registers Value and Memory Data during Debug</h3>
<p>This step can only be done with a microcontroller board running during debugging.</p>
<ol>
<li>
<p>To view the register values during debugging, select the "Registers" tab beside the Project Explorer tab on the left-hand side. You should now see the register from r0-r12, sp, lr, pc, ...</p>
</li>
<li>
<p>To view memory data, at the bottom right, select the "Memory" tab. Click the plus (+) symbol then type in the memory address you want to view. Usually, the memory area you want to view will be somewhere between 0x20000000 to 0x3FFFFFFF.</p>
</li>
</ol>
<h2 id="lab-questions">Lab Questions</h2>
<p>Using the skills and knowledge acquired from this lab, answer the following post-lab question(s) on Blackboard.</p>
<ol>
<li>
<p>Refer to the Memory map shown in class or from Figure 4.18 of Yiu, what is the starting address and ending address of the instruction code region?</p>
</li>
<li>
<p>In the hello_world.c example, what is the instruction address of the first line of code that it halts on once you start debugging?</p>
</li>
</ol>
<p><strong>Note:</strong> The instruction is at a hex address within the instruction region. You can find it in the disabled code or the Disassembly view during debug.</p>
<p><strong>Hint:</strong> The main function starts at address 0x00000924.</p>
<ol>
<li>
<p>Look at the register tab, what is the value of the Program Counter (PC) when you first start debugging? Refer back to the memory map in question 1 and see if it corresponds to the proper memory region.</p>
</li>
<li>
<p>What is the value of the Stack Pointer (SP)? Refer back to the memory map in question 1 and see if it corresponds to the proper memory region.</p>
</li>
<li>
<p>Change the C-code to also display your name and student number within the print statement. Copy your main function onto blackboard.</p>
</li>
<li>
<p>Run your modified code and view the result using the serial terminal. Your name and student number should now be displayed in the serial terminal. Take a screenshot of the printout and place it onto Blackboard.</p>
</li>
</ol>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
