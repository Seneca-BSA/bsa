<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Lab 1 : Intro to ROS and TurtleSim - BSA Lab Manuals</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Lab 1 : Intro to ROS and TurtleSim";
        var mkdocs_page_input_path = "aig240/lab1.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> BSA Lab Manuals
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Lab Manuals</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../ses250/">SES250 Electromagnatics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../seh500/">SEH500 Microprocessors</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../sep600/">SEP600 Embedded Systems</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../sea700/">SEA700 Robotics</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">BSA Lab Manuals</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Lab 1 : Intro to ROS and TurtleSim</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="lab-1-intro-to-ros-and-turtlesim">Lab 1 : Intro to ROS and TurtleSim</h1>
<p><font size="5">
Seneca Polytechnic</br>
AIG240 Robotics
</font></p>
<h2 id="introduction">Introduction</h2>
<p>In this course, you'll be using the <a href="https://www.hiwonder.com/products/jetauto-pro?variant=40040875229271&amp;srsltid=AfmBOopGiD-7htdo9MYV2dDxaC_hu9xuS887mAu3p1SuU0YDl9iVj6Da">JetAuto Pro ROS Robot Car</a> as the base platform for development. The JetAuto robot uses the NVIDIA Jetson Nano embedded computing boards as its controller. The robot comes with various accessories and add-ons for robotics applications and they can all be controlled using <a href="https://www.ros.org/">Robot Operating System (ROS)</a> as the backbone application. However, before jumping into using the physical, we will be learning how to use ROS and <a href="https://gazebosim.org/">Gazebo</a> to simulate the robot and it's environmental. During the design phase of any robotics project, testing the functionality of your code and the robot is a key step of project cycle. In some industrial settings (such as robot in remote location), physical access to the robot are limited or impossible. In such a case, simulating the robot's action and performance is the only way to ensure mission success.</p>
<h3 id="what-is-ros">What is ROS?</h3>
<p>Per the ROS website:</p>
<blockquote>
<p>The Robot Operating System (ROS) is a set of software libraries and tools that help you build robot applications. From drivers to state-of-the-art algorithms, and with powerful developer tools, ROS has what you need for your next robotics project. And it's all open source.</p>
</blockquote>
<p>The above statement isn't exactly clear so let's take a look at an example.</p>
<p><img alt="Figure 1.1 Robotics Arm" src="../lab1-robot-arm.png" /></p>
<p><em><strong>Figure 1.1</strong> Robotics Arm (Source: Hiwonder)</em></p>
<p>A robotics system usually consist of various sensors, actuators, and controllers. The system in Figure 1.1 have the following:</p>
<ol>
<li>a servo gripper at the end of the arm</li>
<li>a servo revolute joint that rotate the gripper</li>
<li>a servo revolute joint for link 3-2</li>
<li>a servo revolute joint for link 4-3</li>
<li>a servo revolute joint for link 5-4</li>
<li>a servo revolute joint that rotate the base</li>
<li>a stationary camera supervise the workspace</li>
</ol>
<p>To pick up an object, the robot might:</p>
<ul>
<li>Use the camera to measure the position of the object</li>
<li>Command the arm to move toward the object's position</li>
<li>Once in position, command the gripper to close around the object</li>
</ul>
<p>To approach this problem, we'll need to break it down into smaller task. In robotics, that usually means having independent low-level control loops, each controlling a single task.</p>
<ul>
<li>A control loop for each joint that, given a position or velocity command, controls the power applied to the joint motor based on position sensor measurements at the joint.</li>
<li>Another control loop that receives commands to open or close the gripper, then switches the gripper motor on and off while controlling the power applied to it to avoid crushing objects.</li>
<li>A sensing loop that reads individual images from the camera</li>
</ul>
<p>With the above structure, we then couple these low-level loops together via a single high-level module that performs supervisory control of the whole system:</p>
<ul>
<li>Query the camera sensing loop for a single image</li>
<li>Use a vision algorithm to compute the location of the object to grasp</li>
<li>Compute the joint angles necessary to move the manipulator arm to this location</li>
<li>Sends position commands to each of the joint control loops telling them to move to this position</li>
<li>Signal the gripper control loop to close the gripper to grab the object</li>
</ul>
<p>An important feature of this design is that the supervisor need not know the implementation details of any of the low-level control loops: it interacts with each only through simple control messages. This encapsulation of functionality makes the system modular, making it easier to reuse code across robotic platforms.</p>
<p>In ROS, each individual control loop is known as a node, an individual software process that performs a specific task. Nodes exchange control messages, sensor readings, and other data by publishing or subscribing to topics or by sending requests to services offered by other nodes (these concepts will be discussed in detail later in the lab).</p>
<p>Nodes can be written in a variety of languages (including Python and C++), and ROS transparently handles the details of converting between different datatypes, exchanging messages between nodes, etc.</p>
<p>We can then visualize the communication and interaction between different software components via a computation graph, where:</p>
<p><img alt="Figure 1.2 Example computation graph" src="../lab1-computation-graph.png" /></p>
<p><em><strong>Figure 1.2</strong> Example computation graph</em></p>
<ul>
<li>Nodes are represented by ovals (ie. <code>/usb_cam</code> or <code>/ar_track_alvar</code>).</li>
<li>Topics are represented by rectangles (ie. <code>/usb_cam/camera_info</code> and <code>/usb_cam/image_raw</code>).</li>
<li>The flow of information to and from topics and represented by arrows. In the above example, <code>/usb_cam publishes</code>
to the topics <code>/usb_cam/camera_info</code> and <code>/usb_cam/image_raw</code>, which are subscribed to by <code>/ar_track_alvar</code>.</li>
<li>While not shown here, services would be represented by dotted arrows.</li>
</ul>
<h2 id="procedures">Procedures</h2>
<h3 id="ubuntu-installation">Ubuntu Installation</h3>
<p>For this course, we'll be using the following software environment <strong>Ubuntu 18.04 LTS (Bionic Beaver)</strong>. If you are using Windows or macOS, ensure Ubuntu 18.04 LTS (Bionic Beaver) and ROS Melodic is installed as it is the version used by the JetAuto robot.</p>
<ol>
<li>
<p>Install Ubuntu 18.04 LTS (Bionic Beaver) on your computer or virtual machine (VirtualBox recommended).</p>
<ul>
<li>OS Image: <a href="https://www.releases.ubuntu.com/bionic/ubuntu-18.04.6-desktop-amd64.iso">ubuntu-18.04.6-desktop-amd64.iso</a></li>
<li>Ensure there are at least 2 processor core, 4GB of memory, and 20GB of disk drive</li>
<li>Ensure to use username: <strong>jetauto</strong> as this is the username used by the JetAuto robot to maximize compartibility of code</li>
</ul>
</li>
</ol>
<h3 id="ros-installation">ROS Installation</h3>
<ol>
<li>
<p>Follow the <a href="https://wiki.ros.org/melodic/Installation/Ubuntu">ROS Melodic Installation</a> instruction to install the ROS Desktop-Full package into your system. <strong>You do NOT need to install the Bare Bones or Individual Package</strong></p>
</li>
<li>
<p>Since we want our terminal to load the ROS source everytime it start, add the <code>source</code> command to <code>.bashrc</code>.</p>
<pre><code>echo "source /opt/ros/melodic/setup.bash" &gt;&gt; ~/.bashrc
</code></pre>
<p>Or use <code>vi</code>, <code>vim</code> or any editor to open <code>~/.bashrc</code> in your user's home directory then add the following code at the end.</p>
<pre><code>source /opt/ros/melodic/setup.bash
</code></pre>
</li>
<li>
<p>After ROS installation and setting up <code>.bashrc</code>, we'll also want to install a few tools to help build ROS packages.</p>
<p>To install this tool and other dependencies for building ROS packages, run:</p>
<pre><code>sudo apt install python-rosdep python-rosinstall python-rosinstall-generator python-wstool build-essential
</code></pre>
</li>
<li>
<p>Before you can use many ROS tools, you will need to initialize <code>rosdep</code>. <code>rosdep</code> enables you to easily install system dependencies for source you want to compile and is required to run some core components in ROS. With the following, you can initialize <code>rosdep</code>.</p>
<pre><code>sudo rosdep init
rosdep update
</code></pre>
<p>Since Melodic is not longer a support distro, we'll need to explicitly update it.</p>
<pre><code>rosdep update --rosdistro=melodic
</code></pre>
</li>
</ol>
<h3 id="turtlesim-test">Turtlesim Test</h3>
<p>Turtlesim is a lightweight simulator for learning ROS. It illustrates what ROS does at the most basic level to give you an idea of what you will do with a real robot or a robot simulation later on.</p>
<h4 id="using-roscore">Using roscore</h4>
<ol>
<li>
<p><code>roscore</code> is the first thing you should run when using ROS. It starts the ROS master node, the centralized server for managing nodes, topics, services, communication, and more. It is typically the main entry point and the first for running any ROS system. In a terminal, run:</p>
<pre><code>roscore
</code></pre>
<p>You will see something similar to:</p>
<pre><code>... logging to ~/.ros/log/9cf88ce4-b14d-11df-8a75-00251148e8cf/roslaunch-machine_name-13039.log
Checking log directory for disk usage. This may take awhile.
Press Ctrl-C to interrupt
Done checking log file disk usage. Usage is &lt;1GB.

started roslaunch server http://machine_name:33919/
ros_comm version 1.4.7

SUMMARY
======

PARAMETERS
* /rosversion
* /rosdistro

NODES

auto-starting new master
process[master]: started with pid [13054]
ROS_MASTER_URI=http://machine_name:11311/

setting /run_id to 9cf88ce4-b14d-11df-8a75-00251148e8cf
process[rosout-1]: started with pid [13067]
started core service [/rosout]
</code></pre>
</li>
</ol>
<h4 id="using-rosrun">Using rosrun</h4>
<ol>
<li>
<p>The command <code>rosrun</code> allows you to use the package name to directly run a node within a package (without having to know the package path). Usage: <code>rosrun [package_name] [node_name]</code>.</p>
<p>So now we can run the <code>turtlesim_node</code> in the turtlesim package. In a new terminal:</p>
<pre><code>rosrun turtlesim turtlesim_node
</code></pre>
<p>The simulator window should appear, with a random turtle in the center.</p>
<p><img alt="Figure 1.3 TurtleSim" src="../lab1-turtlesim.png" /></p>
<p><em><strong>Figure 1.3</strong> TurtleSim</em></p>
</li>
<li>
<p>Open a new terminal to run a new node to control the turtle in the first node. If you didn't add the <code>source</code> code in <code>.bashrc</code>, you'll need to source ROS again.</p>
<pre><code>rosrun turtlesim turtle_teleop_key
</code></pre>
<p>At this point you should have four windows open: a terminal running <code>roscore</code>, a terminal running <code>turtlesim_node</code>, a terminal running <code>turtle_teleop_key</code> and the "turtlesim window". Arrange these windows so that you can see the turtlesim window, but also have the terminal running <code>turtle_teleop_key</code> active so that you can control the turtle in turtlesim.</p>
</li>
<li>
<p>Use the arrow keys on your keyboard to control the turtle. It will move around the screen, using its attached “pen” to draw the path it followed so far.</p>
<p><img alt="Figure 1.4 Turtle Moving" src="../lab1-turtle-moving.png" /></p>
<p><em><strong>Figure 1.4</strong> TurtleSim</em></p>
</li>
</ol>
<h3 id="use-rqt">Use rqt</h3>
<p>rqt is a graphical user interface (GUI) tool for ROS. Everything done in rqt can be done on the command line, but rqt provides a more user-friendly way to manipulate ROS elements.</p>
<ol>
<li>
<p>Open a new terminal and run rqt.</p>
<pre><code>rqt
</code></pre>
</li>
<li>
<p>When running rqt for the first time, the window will be blank. No worries; just select <strong>Plugins &gt; Services &gt; Service Caller</strong> from the menu bar at the top.</p>
<p><img alt="Figure 1.5 rqt" src="../lab1-rqt.png" /></p>
<p><em><strong>Figure 1.5</strong> rqt</em></p>
</li>
<li>
<p>Use the refresh button to the left of the Service dropdown list to ensure all the services of your turtlesim node are available.</p>
</li>
<li>
<p>Click on the Service dropdown list to see turtlesim’s services, and select the <code>/spawn</code> service to spawn another turtle.</p>
<p>Give the new turtle a unique name, like <code>turtle2</code>, by double-clicking between the empty single quotes in the <strong>Expression</strong> column. You can see that this expression corresponds to the value of <strong>name</strong> and is of type <strong>string</strong>.</p>
<p>Next enter some valid coordinates at which to spawn the new turtle, like x = <code>1.0</code> and y = <code>1.0</code>.</p>
<p><img alt="Figure 1.5 rqt spawn" src="../lab1-rqt-spawn.png" /></p>
<p><em><strong>Figure 1.5</strong> rqt spawn</em></p>
<p>If you try to spawn a new turtle with the same name as an existing turtle, you will get an error message in the terminal running <code>turtlesim_node</code>.</p>
</li>
<li>
<p>Call the <code>spawn</code> service by clicking the Call button on the upper right side of the rqt window. You should see a new turtle (with a random design) spawn at the coordinates you input for x and y.</p>
</li>
<li>
<p>Refresh the service list in rqt and you will also see that now there are services related to the new turtle, <code>/turtle2/...</code>, in addition to <code>/turtle1/...</code>.</p>
</li>
<li>
<p>Next, we'll give <code>turtle1</code> an unique pen using the <code>/set_pen</code> service and have <code>turtle1</code> draw with a distinct red line by changing the value of <strong>r</strong> to <code>255</code>, and the value of <strong>width</strong> to <code>5</code>. Don’t forget to call the service after updating the values.</p>
<p><img alt="Figure 1.6 rqt set_pen" src="../lab1-rqt-set-pen.png" /></p>
<p><em><strong>Figure 1.6</strong> rqt set_pen</em></p>
</li>
<li>
<p>Return to the terminal where <code>turtle_teleop_key</code> is running and press the arrow keys, you will see <code>turtle1</code>’s pen has changed.</p>
<p><img alt="Figure 1.7 TurtleSim Turtles" src="../lab1-turtlesim-2.png" /></p>
<p><em><strong>Figure 1.7</strong> TurtleSim Turtles</em></p>
</li>
</ol>
<h3 id="remapping-turtle_teleop_key">Remapping <code>turtle_teleop_key</code></h3>
<ol>
<li>
<p>To control <code>turtle2</code>, you need a second teleop node. However, if you try to run the same command as before, you will notice that this one also controls turtle1. The way to change this behavior is by remapping the <code>cmd_vel</code> topic.</p>
<p>In a new terminal, source ROS, and run:</p>
<pre><code>rosrun turtlesim turtle_teleop_key turtle1/cmd_vel:=turtle2/cmd_vel
</code></pre>
<p>Now, you can move <code>turtle2</code> when this terminal is active, and <code>turtle1</code> when the other terminal running <code>turtle_teleop_key</code> is active.</p>
<p><img alt="Figure 1.8 TurtleSim Turtles Moving" src="../lab1-turtlesim-3.png" /></p>
<p><em><strong>Figure 1.8</strong> TurtleSim Turtles</em></p>
</li>
</ol>
<h2 id="lab-exercise">Lab Exercise</h2>
<ol>
<li>Create a third turtle that you can control in turtlesim with green (g = 255) as the pen line colour.</li>
</ol>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="https://wiki.ros.org/ROS/Tutorials">ROS Tutorials</a></li>
<li>EECS 106A Labs</li>
</ul>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
