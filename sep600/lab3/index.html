<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Lab 3 : DAC and ADC - BSA Lab Manuals</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Lab 3 : DAC and ADC";
        var mkdocs_page_input_path = "sep600/lab3.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> BSA Lab Manuals
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Lab Manuals</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../ses250/">SES250 Electromagnatics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../seh500/">SEH500 Microprocessors</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../">SEP600 Embedded Systems</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">BSA Lab Manuals</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Lab 3 : DAC and ADC</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="lab-3-dac-and-adc">Lab 3 : DAC and ADC</h1>
<p><font size="5">
Seneca College</br>
SEP600 Embedded Systems
</font></p>
<h2 id="introduction">Introduction</h2>
<p>Documentation of the Cortex-M4 instruction set, board user's guide, and the microcontroller reference manual can be found here:</p>
<h3 id="cortex-m4">Cortex M4</h3>
<ul>
<li><a href="https://developer.arm.com/documentation/100166/0001">Arm Cortex-M4 Processor Technical Reference Manual Revision</a></li>
<li><a href="https://developer.arm.com/documentation/ddi0403/latest/">ARMv7-M Architecture Reference Manual</a></li>
</ul>
<h3 id="frdm-k64f">FRDM-K64F</h3>
<ul>
<li><a href="../FRDMK64FUG.pdf">FRDM-K64F Freedom Module User’s Guide</a> (From <a href="https://www.nxp.com/webapp/Download?colCode=FRDMK64FUG">nxp.com</a>)</li>
<li><a href="../K64P144M120SF5RM.pdf">Kinetis K64 Reference Manual</a> (From <a href="https://www.nxp.com/webapp/Download?colCode=K64P144M120SF5RM">nxp.com</a>)</li>
<li><a href="https://os.mbed.com/platforms/FRDM-K64F/">FRDM-K64F mbed</a></li>
</ul>
<h3 id="frdm-k66f">FRDM-K66F</h3>
<ul>
<li><a href="../FRDMK66FUG.pdf">FRDM-K66F Freedom Module User’s Guide</a> (From <a href="https://www.nxp.com/webapp/Download?colCode=FRDMK66FUG">nxp.com</a>)</li>
<li><a href="../K66P144M180SF5RMV2.pdf">Kinetis K66 Reference Manual</a> (From <a href="https://www.nxp.com/webapp/Download?colCode=K66P144M180SF5RMV2">nxp.com</a>)</li>
<li><a href="https://os.mbed.com/platforms/FRDM-K66F/">FRDM-K66F mbed</a></li>
</ul>
<h2 id="materials">Materials</h2>
<ul>
<li>Safety glasses (PPE)</li>
<li>Breadboard</li>
<li>Jumper Wires</li>
<li>(1x) 1kΩ-10kΩ Resistor</li>
<li>(1x) Potentiometer (Optional)</li>
</ul>
<h2 id="preparation">Preparation</h2>
<blockquote>
<h3 id="lab-preparation-question">Lab Preparation Question</h3>
<ol>
<li>Read over the lab and understand the procedures.</li>
</ol>
</blockquote>
<h2 id="procedures">Procedures</h2>
<h3 id="part-1-pwm-output-vs-dac-output">Part 1: PWM Output vs DAC Output</h3>
<p>In Part 1, we'll set up a PWM and a DAC to compare the difference between the output.</p>
<ol>
<li>Connect a PWM output pin to CH1 of the DSO. Refer to the mbed board pages to identify which pin is a PWM pin.</li>
<li>Connect a DAC output pin to CH2 of the DSO. Refer to the mbed board pages to identify which pin is a DAC pin.</li>
<li>
<p>Upload the following code to generate a PWM and a DAC output. Remember, you'll need to replace PTXX with the PWM pin that you are using.
    <pre></p>
<pre><code>int main()
{
    // setup pins
    PwmOut pwm(PTXX); // replace with a PWM pin
    AnalogOut aout(DAC0_OUT);

    // pwm settings
    pwm.period(0.02f); // 50Hz pwm, 0.02s period

    printf("Program started!\r\n"); // added to test serial

    while (true) 
    {
        // loop to cycle from 0% to 100%
        for (float i = 0.0f; i &lt; 1.0f; i += 0.01f)
        {
            aout = i; // set DAC out %
            pwm = i; // set PWM duty cycle %

            // delay for 10ms, 1000ms for each ramp up
            ThisThread::sleep_for(10ms);
        }

        // loop to cycle from 100% to 0%
        for (float i = 1.0f; i &gt; 0.0f; i -= 0.01f)
        {
            aout = i; // set DAC out %
            pwm = i; // set PWM duty cycle %

            // delay for 10ms, 1000ms for each ramp down
            ThisThread::sleep_for(10ms);
        }
    }
}
</code></pre>
</pre>
</li>
<li>
<p>Turn on the DSO and run the program. You should see something similar to the figure below on your DSO except it'll be a triangular wave instead of a sine wave.</p>
<p><img alt="Figure 3.1" src="../lab3-dac-pwm.png" /></p>
<p><em><strong>Figure 3.1</strong> DAC and PWM output</em></p>
<blockquote>
<p><strong>Lab Question:</strong> What circuit should you apply to the PWM output if you want to see the same waveform as the DAC output?</p>
</blockquote>
</li>
<li>
<p>Keep the DSO connected.</p>
</li>
</ol>
<h3 id="part-2-adc-input">Part 2: ADC Input</h3>
<p>Next, we'll connect the ADC to an analog voltage input so it can be read into the microcontroller. The voltage signal will come from the bench power supply. To prevent damaging the ADC, we'll first use a voltage division to halve the signal. <strong>Never connect the power supply directly to the ADC without a resistor.</strong></p>
<p><img alt="Figure 3.2" src="../lab3-vs-adc.png" /></p>
<p><em><strong>Figure 3.2</strong> Voltage division circuit for ADC input</em></p>
<ol>
<li>Assemble the voltage division circuit above on your breadboard and connect the voltage divider output to an analog input pin. Vs will be provided by the bench power supply. Ensure the power supply output is OFF. Optionally, you can use a potentiometer to achieve the same.</li>
<li>As a precaution, we only want to supply a maximum of 3.3V to the ADC pin, this means the power supply output should never to above 6.6V. Set the power supply output to 1V.</li>
<li>
<p>Add the following code in the main function of your code but before the while loop to set up an analog input pin. Remember, you'll need to replace PTXX with the PWM pin that you are using.
    <pre></p>
<pre><code>int main()
{
    ...
    AnalogIn ain(PTXX); // replace with a ADC pin
    ...
}
</code></pre>
</pre>
</li>
<li>
<p>Next, replace the while loop with the following code so we are controlling the DAC output and the PWM duty cycle with the analog input.
    <pre></p>
<pre><code>while (true)
{
    i = ain; // read ADC
    aout = i; // set DAC out %
    pwm = i; // set PWM duty cycle %

    // delay for 10ms, 1000ms for each ramp up
    ThisThread::sleep_for(100ms);
}
</code></pre>
</pre>
</li>
<li>
<p>Next, let's print the reading out as well. Modify your code to include the following respectively.
    <pre></p>
<pre><code>while (true)
{
    ...
    // print the percentage, 16 bit normalized values, and something we understand
    printf("percentage: %3.3f%% ", ain.read() * 100.0f);
    printf("normalized: 0x%04X ", ain.read_u16());
    printf("normalized: %3.3fV \n", ain * 3.3); // % * 3.3V
    ...
}
</code></pre>
</pre>
</li>
<li>
<p>Per <a href="https://github.com/ARMmbed/mbed-os/blob/master/platform/source/minimal-printf/README.md">Minimal printf and snprintf</a>, as of mbed OS 6, printf no longer print floating point by default to save memory. In order to enable printing of floating point value, enable it by creating a file called <code>mbed_app.json</code> in the root project folder and add the following code to it.
    <pre></p>
<pre><code>{
    "target_overrides": {
        "*": {
            "target.printf_lib": "std"
        }
    }
}
</code></pre>
</pre>
</li>
<li>
<p>Turn on the power supply output and run the program. You should see a constant 0.5V on the DSO, at about 15% duty cycle PWM wave, and a serial output state of about 15% and 0.5V.</p>
<blockquote>
<p><strong>Lab Question:</strong> What do you think can be done to reduce reading fluctuation? How do you think that can be achieved?</p>
</blockquote>
</li>
</ol>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="https://os.mbed.com/docs/mbed-os/v6.16/apis/i-o-apis.html">mbed I/O API</a></li>
<li><a href="https://os.mbed.com/docs/mbed-os/v6.16/apis/pwmout.html">PwmOut</a></li>
<li><a href="https://os.mbed.com/docs/mbed-os/v6.16/apis/analogout.html">AnalogOut</a></li>
<li><a href="https://os.mbed.com/docs/mbed-os/v6.16/apis/i-o-apis.html">AnalogIn</a></li>
</ul>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
